
# WEEK 7
## Obligatory

2. （`必做`）按上周设计的表结构，插入 100 万订单模拟数据，测试不同方式的插入效率
* 降低在10秒以内
* solution 1: PreparedStatement，减少SQL解析。先发送一个SQL语句，中间的参数用问号占位；再发送多次参数提交给数据库。解析成本仅一次。
* solution 2: 多值（INSERT语句中拼多条记录） / 批量（PreparedStatement中ADD BATCH）插入。
* solution 3: Load Data 原生命令，文本文件直接导入数据。
* solution 4: 先把约束和索引去除，导入数据；之后一次性重建所有约束和索引。
--------------------------------

9. （`必做`）读写分离 - 动态切换数据源版本 1.0
* 基于 Spring / Spring Boot，配置多个数据源  
* 方式————根据具体的 service 方法是否会操作数据，注入不同的数据源（注解/参数）
* （改进一）简化自动切换数据源：基于操作 AbstractRoutingDataSource 和自定义注解 readOnly 等
    * 基础设施 AbstractRoutingDataSource：基于抽象数据源自定义一个数据源，其他实际的数据源创建在虚拟数据源内部；外层使用抽象数据源。
    * 根据业务条件或自定义标记：自动切换数据源。
* （改进二）支持配置多个从库。
* （改进三）支持多个从库的负载均衡：路由算法。灵活使用从库，提高效率。

10. （`必做`）读写分离 - 数据库框架版本 2.0
* 使用ShardingSphere-jdbc 5.0.0-alpha 实现读写分离配置
* 方式————`ShardingSphere-jdbc` 的 Master-Slave 功能
    * SQL 解析和事务管理，自动实现读写分离
        * select：走从库
        * update, delete, insert：走主库
    * 解决“写完读”不一致问题
        * 只要遇到一个写操作，之后`同一事务内部`其他操作全都走主库。
* 实战：使用ShardingSphere-jdbc 5.0.0-alpha 实现读写分离配置

--------------------------------

## Optional

1. （选做）用本周学习的知识，分析自己系统的 SQL 和表结构

3. （选做）按上周设计的表结构，插入 1000 万订单模拟数据，测试不同方式的插入效率

4. （选做）使用不同的索引或组合，测试不同方式查询效率

5. （选做）调整测试数据，使得数据尽量均匀，模拟 1 年时间内的交易，计算一年的销售报表：销售总额，订单数，客单价，每月销售量，前十的商品等等（可以自己设计更多指标）

6. （选做）尝试自己做一个 ID 生成器（可以模拟 Seq 或 Snowflake）

7. （选做）尝试实现或改造一个非精确分页的程序

--------------------------------

8. （选做）配置一遍异步复制，半同步复制、组复制

11. （选做）读写分离 - 数据库中间件版本 3.0

12. （选做）配置 MHA，模拟 master 宕机

13. （选做）配置 MGR，模拟 master 宕机

14. （选做）配置 Orchestrator，模拟 master 宕机，演练 UI 调整拓扑结构
